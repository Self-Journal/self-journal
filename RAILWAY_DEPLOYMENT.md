# Railway Deployment Guide

This guide will help you deploy SelfJournal to Railway, the recommended cloud platform for this application.

## Why Railway?

Railway is the **recommended cloud deployment option** for SelfJournal because:

- ‚úÖ **Native SQLite Support** - Persistent volumes work out of the box
- ‚úÖ **Zero Configuration** - Deploy with one click
- ‚úÖ **Automatic SSL** - HTTPS certificates included
- ‚úÖ **Fair Pricing** - $5 free credit/month, pay only for what you use
- ‚úÖ **Great Developer Experience** - Easy to use dashboard and CLI
- ‚úÖ **Built-in Metrics** - Monitor CPU, memory, and network usage

Unlike platforms like Vercel that use ephemeral storage (which would lose your SQLite database on every deploy), Railway provides persistent volumes that keep your data safe.

## Quick Deploy

### Option 1: One-Click Deploy (Easiest)

[![Deploy on Railway](https://railway.app/button.svg)](https://railway.app/template/selfjournal)

1. Click the button above
2. Sign in with GitHub
3. Configure your deployment:
   - **Project Name**: Choose a name (e.g., "my-selfjournal")
   - **NEXTAUTH_URL**: Will be auto-filled after deployment
4. Click **"Deploy"**
5. Wait for the build to complete (~2-3 minutes)
6. Click on your deployment to get the URL
7. Update the `NEXTAUTH_URL` environment variable with your Railway URL

### Option 2: Deploy from GitHub Repository

1. Fork or clone the repository to your GitHub account
2. Go to [Railway](https://railway.app/)
3. Click **"New Project"**
4. Select **"Deploy from GitHub repo"**
5. Choose `Self-Journal/self-journal` (or your fork)
6. Railway will auto-detect the configuration from `railway.json`
7. Set environment variables (see below)
8. Deploy!

### Option 3: Railway CLI (For Developers)

```bash
# Install Railway CLI
npm i -g @railway/cli

# Login to Railway
railway login

# Initialize project
railway init

# Link to your repository
railway link

# Set environment variables
railway variables set NEXTAUTH_SECRET=$(openssl rand -base64 32)

# Deploy
railway up

# Get the URL
railway domain
```

## Environment Variables

Railway will auto-generate some variables, but you need to configure:

| Variable | Value | Required |
|----------|-------|----------|
| `NEXTAUTH_SECRET` | Auto-generated by Railway | ‚úÖ Yes |
| `NEXTAUTH_URL` | Your Railway URL (e.g., `https://yourapp.up.railway.app`) | ‚úÖ Yes |
| `NODE_ENV` | `production` (default) | No |
| `PORT` | `3000` (default) | No |

### Setting Environment Variables

**Via Dashboard:**
1. Go to your project in Railway
2. Click on your service
3. Go to **"Variables"** tab
4. Add/edit variables
5. Redeploy for changes to take effect

**Via CLI:**
```bash
railway variables set NEXTAUTH_URL=https://yourapp.up.railway.app
```

## Database Persistence

Railway automatically creates a **persistent volume** for your application:

- **Location**: `/app` directory (where your code runs)
- **Database File**: `bulletjournal.db` in the project root
- **Persistence**: Survives deployments and restarts
- **Backup**: Automatically backed up by Railway

### Accessing Your Database

**Via Railway CLI:**
```bash
# SSH into your container
railway shell

# Check if database exists
ls -la bulletjournal.db

# View database size
du -h bulletjournal.db
```

## Custom Domain

### Add Your Own Domain

1. Go to your service in Railway
2. Click **"Settings"**
3. Scroll to **"Domains"**
4. Click **"Add Domain"**
5. Enter your domain (e.g., `journal.yourdomain.com`)
6. Add the CNAME record to your DNS:
   - **Type**: CNAME
   - **Name**: journal (or your subdomain)
   - **Value**: Your Railway domain

Railway will automatically provision an SSL certificate.

## Monitoring and Logs

### View Logs

**Via Dashboard:**
1. Go to your service
2. Click **"Deployments"**
3. Click on active deployment
4. View real-time logs

**Via CLI:**
```bash
railway logs
```

### Metrics

Railway provides built-in metrics:
- **CPU Usage**
- **Memory Usage**
- **Network Traffic**
- **Deployment History**

Access via your service dashboard ‚Üí **"Metrics"** tab

## Backups

### Manual Database Backup

```bash
# Download database from Railway
railway run cat bulletjournal.db > backup-$(date +%Y%m%d).db

# Or using railway shell
railway shell
cat bulletjournal.db > /tmp/backup.db
exit
```

### Automated Backups

Create a GitHub Action to backup regularly:

```yaml
# .github/workflows/backup.yml
name: Database Backup

on:
  schedule:
    - cron: '0 0 * * 0' # Weekly on Sunday

jobs:
  backup:
    runs-on: ubuntu-latest
    steps:
      - name: Install Railway CLI
        run: npm i -g @railway/cli

      - name: Backup Database
        env:
          RAILWAY_TOKEN: ${{ secrets.RAILWAY_TOKEN }}
        run: |
          railway run cat bulletjournal.db > backup.db

      - name: Upload to GitHub
        uses: actions/upload-artifact@v3
        with:
          name: database-backup
          path: backup.db
```

## Scaling

Railway's free tier includes:
- **$5 free credit/month**
- **512 MB RAM**
- **1 vCPU**
- **100 GB outbound traffic**

This is **sufficient for 100-500 active users**.

To scale:
1. Upgrade to Pro plan ($20/month)
2. Increase resources in service settings
3. Monitor usage in metrics dashboard

## Troubleshooting

### Database Not Persisting

**Problem**: Database resets after deployment

**Solution**:
1. Check that `bulletjournal.db` is in project root (not in `.gitignore`)
2. Verify volume is mounted correctly
3. Check Railway logs for errors

### Build Failures

**Problem**: Deployment fails during build

**Solution**:
1. Check build logs in Railway dashboard
2. Verify `package.json` scripts are correct
3. Ensure all dependencies are listed
4. Try clearing build cache (Settings ‚Üí Clear Cache)

### Environment Variables Not Working

**Problem**: App doesn't recognize environment variables

**Solution**:
1. Verify variables are set in Railway dashboard
2. Redeploy after changing variables
3. Check variable names match exactly (case-sensitive)

### Out of Memory

**Problem**: App crashes with out of memory errors

**Solution**:
1. Upgrade to larger Railway plan
2. Optimize your app (reduce memory usage)
3. Check for memory leaks in logs

## Cost Estimation

Railway uses **usage-based pricing**:

**Free Tier:**
- $5 credit/month
- Good for personal use and small teams
- ~100-500 active users

**Pro Plan ($20/month):**
- Execution time: $0.000463/vCPU-second
- Memory: $0.000231/GB-second
- Outbound traffic: $0.10/GB

**Example costs for 1,000 active users:**
- CPU: ~$10/month
- Memory: ~$5/month
- Traffic: ~$2/month
- **Total: ~$17/month**

## Comparing to Other Platforms

| Platform | SQLite Support | Cost | Ease of Use |
|----------|----------------|------|-------------|
| **Railway** | ‚úÖ Native | $5-20/mo | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê |
| Vercel | ‚ùå Ephemeral | Free-$20/mo | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê |
| Fly.io | ‚úÖ Volumes | $0-10/mo | ‚≠ê‚≠ê‚≠ê |
| Render | ‚úÖ Disks | $7/mo | ‚≠ê‚≠ê‚≠ê‚≠ê |
| DigitalOcean | ‚úÖ Manual | $5/mo | ‚≠ê‚≠ê |

Railway offers the best balance of ease-of-use and SQLite support.

## Next Steps

After deploying to Railway:

1. ‚úÖ Test the deployment (create account, add tasks)
2. ‚úÖ Set up custom domain (optional)
3. ‚úÖ Configure backups
4. ‚úÖ Monitor usage and metrics
5. ‚úÖ Share with users!

## Getting Help

- **Railway Docs**: https://docs.railway.app
- **Railway Discord**: https://discord.gg/railway
- **SelfJournal Issues**: https://github.com/Self-Journal/self-journal/issues

---

**Happy journaling on Railway! üöÇ**
